import{M as P,d as Z,m as f,D as me,r as s,o as y,e as w,w as t,g as e,q as a,c as K,F as q,b as T,f as W,B,t as ae,T as _e,J as D,j as ge,P as O,v as fe,Q as Se,n as ee,K as ve,O as X,S as Y}from"./index-DiapZNiM.js";const ye=(b,k,C)=>P.get(`/admin/product/${b}/${k}?category3Id=${C}`),le=()=>P.get("/admin/product/baseTrademark/getTrademarkList"),ne=b=>P.get("/admin/product/spuImageList/"+b),ue=b=>P.get("/admin/product/spuSaleAttrList/"+b),te=()=>P.get("/admin/product/baseSaleAttrList"),be=b=>b.id?P.post("/admin/product/updateSpuInfo",b):P.post("/admin/product/saveSpuInfo",b),Ie=b=>P.post("/admin/product/saveSkuInfo",b),Ve=b=>P.get("/admin/product/findBySpuId/"+b),ke=b=>P.delete("/admin/product/deleteSpu/"+b),Ae=["src"],Ue=Z({__name:"index",emits:["changeScene"],setup(b,{expose:k,emit:C}){let v=f([]),I=f([]),A=f([]),U=f(),o=me({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const F=async(r,S,_)=>{o.category3Id=_.category3Id,o.spuId=_.id,o.tmId=_.tmId;let p=await _e(r,S,_.category3Id),m=await ue(_.id),i=await ne(_.id);v.value=p.data,I.value=m.data,A.value=i.data},d=()=>{N("changeScene",0,"")},E=r=>{console.log(r),U.value.clearSelection(),U.value.toggleRowSelection(r[r.length-1],!0),o.skuDefaultImg=r[r.length-1].imgUrl},G=r=>{U.value.clearSelection(),U.value.toggleRowSelection(r,!0),o.skuDefaultImg=r.imgUrl};k({initSkuData:F});const M=async()=>{o.skuAttrValueList=v.value.reduce((S,_)=>{if(_.attrIdAndValueId){let[p,m]=_.attrIdAndValueId.split(":");S.push({attrId:p,valueId:m})}return S},[]),o.skuSaleAttrValueList=I.value.reduce((S,_)=>{if(_.saleIdAndValueId){let[p,m]=_.saleIdAndValueId.split(":");S.push({saleAttrId:p,saleAttrValueId:m})}return S},[]);let r=await Ie(o);console.log(r),r.code==200?(D({type:"success",message:"添加SKU成功"}),N("changeScene",0,"")):D({type:"error",message:"添加SKU失败"})};let N=C;return(r,S)=>{const _=s("el-input"),p=s("el-form-item"),m=s("el-option"),i=s("el-select"),L=s("el-form"),h=s("el-table-column"),x=s("el-button"),J=s("el-table");return y(),w(L,{"label-width":"100px"},{default:t(()=>[e(p,{label:"SKU名称"},{default:t(()=>[e(_,{placeholder:"SKU名称",modelValue:a(o).skuName,"onUpdate:modelValue":S[0]||(S[0]=l=>a(o).skuName=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"价格(元)"},{default:t(()=>[e(_,{placeholder:"价格(元)",type:"number",modelValue:a(o).price,"onUpdate:modelValue":S[1]||(S[1]=l=>a(o).price=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"重量(g)"},{default:t(()=>[e(_,{placeholder:"重量(g)",type:"number",modelValue:a(o).weight,"onUpdate:modelValue":S[2]||(S[2]=l=>a(o).weight=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"SKU描述"},{default:t(()=>[e(_,{placeholder:"SKU描述",type:"textarea",modelValue:a(o).skuDesc,"onUpdate:modelValue":S[3]||(S[3]=l=>a(o).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(p,{label:"平台属性:"},{default:t(()=>[e(L,{inline:!0},{default:t(()=>[(y(!0),K(q,null,T(a(v),(l,n)=>(y(),w(p,{key:l.id,label:`${l.attrName}`},{default:t(()=>[e(i,{style:{width:"100px"},modelValue:l.attrIdAndValueId,"onUpdate:modelValue":c=>l.attrIdAndValueId=c},{default:t(()=>[(y(!0),K(q,null,T(l.attrValueList,(c,V)=>(y(),w(m,{value:`${l.id}:${c.id}`,key:c.id,label:c.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"销售属性:"},{default:t(()=>[e(L,{inline:!0},{default:t(()=>[(y(!0),K(q,null,T(a(I),(l,n)=>(y(),w(p,{label:l.saleAttrName,key:l.id},{default:t(()=>[e(i,{style:{width:"100px"},modelValue:l.saleIdAndValueId,"onUpdate:modelValue":c=>l.saleIdAndValueId=c},{default:t(()=>[(y(!0),K(q,null,T(l.spuSaleAttrValueList,(c,V)=>(y(),w(m,{value:`${l.id}:${c.id}`,key:c.id,label:c.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"图片名称"},{default:t(()=>[e(J,{onSelect:E,border:"",data:a(A),ref_key:"table",ref:U},{default:t(()=>[e(h,{type:"selection",width:"80px",align:"center"}),e(h,{label:"图片"},{default:t(({row:l,$index:n})=>[W("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Ae)]),_:1}),e(h,{label:"名称",prop:"imgName"}),e(h,{label:"操作"},{default:t(({row:l,$index:n})=>[e(x,{type:l.imgUrl===a(o).skuDefaultImg?"success":"primary",size:"small",onClick:c=>G(l)},{default:t(()=>[B(ae(l.imgUrl===a(o).skuDefaultImg?"默认展示":"设置默认"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(p,null,{default:t(()=>[e(x,{type:"primary",size:"default",onClick:M},{default:t(()=>[B("保存")]),_:1}),e(x,{type:"primary",size:"default",onClick:d},{default:t(()=>[B("取消")]),_:1})]),_:1})]),_:1})}}}),xe=["src"],he=Z({__name:"index",emits:["changeScene"],setup(b,{expose:k,emit:C}){let v=f([]),I=f([]),A=f([]),U=f([]),o=f(!1),F=f(""),d=f({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]});const E=l=>{F.value=l.url,o.value=!0},G=()=>{},M=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(D({type:"error",message:"上传文件务必小于3M"}),!1):(D({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1),N=ge(()=>U.value.filter(l=>!A.value.find(n=>l.name===n.saleAttrName)));let r=f("");const S=()=>{const[l,n]=r.value.split(":"),c={baseSaleAttrId:l,saleAttrName:n,spuSaleAttrValueList:[]};A.value.push(c),r.value=""},_=f({}),p=(l,n)=>{l.flag=!0,l.saleAttrValue="",fe(()=>{_.value.focus()})},m=(l,n)=>{const{baseSaleAttrId:c,saleAttrValue:V}=l;let g={baseSaleAttrId:c,saleAttrValueName:V};if(V.trim()==""){D({type:"error",message:"属性值不能为空的"}),l.flag=!1;return}if(l.spuSaleAttrValueList.find(H=>H.saleAttrValueName===V)){D({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(g),l.flag=!1},i=async()=>{d.value.spuImageList=I.value.map(n=>({imgName:n.name,imgUrl:n.response&&n.response.data||n.url})),d.value.spuSaleAttrList=A.value,(await be(d.value)).code==200?(D({type:"success",message:d.value.id?"更新成功":"添加成功"}),L("changeScene",0,d.value.id?"updata":"add")):D({type:"success",message:d.value.id?"更新失败":"添加失败"})},L=C,h=()=>{console.log(d.value),L("changeScene",0)};return k({initHasSpuData:async l=>{console.log(l),d.value=l;const n=await le(),c=await ne(l.id),V=await ue(l.id),g=await te();d.value,v.value=n.data,I.value=c.data.map($=>({name:$.imgName,url:$.imgUrl})),A.value=V.data,U.value=g.data},initSpuData:async l=>{Object.assign(d.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[],id:0}),I.value=[],A.value=[],r.value="",d.value.category3Id=l;const n=await le(),c=await te();v.value=n.data,U.value=c.data}}),(l,n)=>{const c=s("el-input"),V=s("el-form-item"),g=s("el-option"),$=s("el-select"),H=s("Plus"),se=s("el-icon"),oe=s("el-upload"),re=s("el-dialog"),R=s("el-button"),Q=s("el-table-column"),de=s("el-tag"),ie=s("el-table"),ce=s("el-form");return y(),w(ce,{"label-width":"100px"},{default:t(()=>[e(V,{label:"SPU名称"},{default:t(()=>[e(c,{style:{width:"200px"},placeholder:"请你输入SPU名称",modelValue:a(d).spuName,"onUpdate:modelValue":n[0]||(n[0]=u=>a(d).spuName=u)},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU品牌"},{default:t(()=>[e($,{style:{width:"200px"},modelValue:a(d).tmId,"onUpdate:modelValue":n[1]||(n[1]=u=>a(d).tmId=u)},{default:t(()=>[(y(!0),K(q,null,T(a(v),(u,j)=>(y(),w(g,{key:u.id,label:u.tmName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU描述"},{default:t(()=>[e(c,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:a(d).description,"onUpdate:modelValue":n[2]||(n[2]=u=>a(d).description=u)},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU图片"},{default:t(()=>[e(oe,{"file-list":a(I),"onUpdate:fileList":n[3]||(n[3]=u=>O(I)?I.value=u:I=u),action:"/api/admin/product/fileUpload","on-preview":E,"on-remove":G,"before-upload":M,"list-type":"picture-card"},{default:t(()=>[e(se,null,{default:t(()=>[e(H)]),_:1})]),_:1},8,["file-list"]),e(re,{modelValue:a(o),"onUpdate:modelValue":n[4]||(n[4]=u=>O(o)?o.value=u:o=u)},{default:t(()=>[W("img",{"w-full":"",src:a(F),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,xe)]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU销售属性"},{default:t(()=>[e($,{modelValue:a(r),"onUpdate:modelValue":n[5]||(n[5]=u=>O(r)?r.value=u:r=u),placeholder:N.value.length>0?`还有${N.value.length}项未选`:"无",style:{width:"200px"}},{default:t(()=>[(y(!0),K(q,null,T(N.value,u=>(y(),w(g,{value:`${u.id}:${u.name}`,key:u.id,label:u.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(R,{disabled:!a(r),style:{"margin-left":"10px"},type:"primary",onClick:S,size:"default",icon:"Plus"},{default:t(()=>[B("添加属性")]),_:1},8,["disabled"]),e(ie,{border:"",style:{margin:"10px 0px"},data:a(A)},{default:t(()=>[e(Q,{label:"序号",type:"index",align:"center",width:"80px"}),e(Q,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(Q,{label:"销售属性值"},{default:t(({row:u,$index:j})=>[(y(!0),K(q,null,T(u.spuSaleAttrValueList,(z,pe)=>(y(),w(de,{style:{margin:"0px 5px"},onClose:we=>u.spuSaleAttrValueList.splice(pe,1),key:u.id,class:"mx-1",closable:""},{default:t(()=>[B(ae(z.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),u.flag==!0?(y(),w(c,{key:0,ref:z=>_.value=z,modelValue:u.saleAttrValue,"onUpdate:modelValue":z=>u.saleAttrValue=z,placeholder:"请你输入属性值",size:"small",style:{width:"100px"},onBlur:z=>m(u,j)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(y(),w(R,{key:1,type:"primary",size:"small",onClick:z=>p(u,j),icon:"Plus"},null,8,["onClick"]))]),_:1}),e(Q,{label:"操作",width:"120px"},{default:t(({row:u,$index:j})=>[e(R,{type:"danger",size:"small",icon:"Delete",onClick:z=>a(A).splice(j,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(V,null,{default:t(()=>[e(R,{disabled:!(a(A).length>0),type:"success",size:"default",onClick:i},{default:t(()=>[B("保存")]),_:1},8,["disabled"]),e(R,{onClick:h,type:"info",size:"default"},{default:t(()=>[B("取消")]),_:1})]),_:1})]),_:1})}}}),Ce=["src"],Ne=Z({__name:"index",setup(b){const k=Se();let C=f(0),v=f(1),I=f(3),A=f(0),U=f([]);const o=f(),F=f(),d=async(m=1)=>{v.value=m;const i=await ye(v.value,I.value,k.thirdCurrID);i.code===200?(U.value=i.data.records,A.value=i.data.total):D({type:"error",message:"GetHasSpuData Error"})};ee([v,I],async()=>{await d(v.value)}),ee(()=>k.thirdCurrID,async()=>{k.thirdCurrID&&await d()});const E=()=>{p(1),o.value.initSpuData(k.thirdCurrID)},G=m=>{p(1),o.value.initHasSpuData(m)},M=m=>{p(2),F.value.initSkuData(k.firstCurrID,k.secondCurrID,m)},N=f(!1);let r=f([]);const S=async m=>{const i=await Ve(m.id);if(console.log(i),i.code===200)r.value=[],r.value=i.data,N.value=!0;else{D({type:"error",message:"GetHasSpuData Error"});return}},_=async m=>{const i=await ke(m.id);console.log(i),i.code===200?U.value.length===1?d(v.value-1):d(v.value):D({type:"error",message:"Delete Failed"})},p=(m,i)=>{C.value=m,d(i==="add"?1:v.value)};return ve(()=>{k.resetStore()}),(m,i)=>{const L=s("Category"),h=s("el-button"),x=s("el-table-column"),J=s("el-popconfirm"),l=s("el-table"),n=s("el-pagination"),c=s("el-dialog"),V=s("el-card");return y(),K(q,null,[e(L,{scene:a(C)},null,8,["scene"]),e(V,{style:{margin:"10px 0px"}},{default:t(()=>[X(W("div",null,[e(h,{disabled:!a(k).thirdCurrID,type:"primary",size:"default",icon:"Plus",onClick:E},{default:t(()=>[B("添加SPU")]),_:1},8,["disabled"]),e(l,{style:{margin:"10px 0px"},border:"",data:a(U)},{default:t(()=>[e(x,{label:"序号",type:"index",align:"center",width:"80px"}),e(x,{label:"SPU名称",prop:"spuName"}),e(x,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(x,{label:"SPU操作"},{default:t(({row:g,$index:$})=>[e(h,{onClick:H=>M(g),type:"success",size:"small",icon:"Plus",title:"添加SKU"},null,8,["onClick"]),e(h,{onClick:H=>G(g),type:"warning",size:"small",icon:"Edit",title:"修改SPU"},null,8,["onClick"]),e(h,{type:"primary",size:"small",icon:"View",onClick:H=>S(g),title:"查看SKU列表"},null,8,["onClick"]),e(J,{title:`确定删除${g.spuName}?`,width:"200px",onConfirm:H=>_(g)},{reference:t(()=>[e(h,{type:"danger",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(n,{"current-page":a(v),"onUpdate:currentPage":i[0]||(i[0]=g=>O(v)?v.value=g:v=g),"page-size":a(I),"onUpdate:pageSize":i[1]||(i[1]=g=>O(I)?I.value=g:I=g),"page-sizes":[3,5,7,9],background:!0,disabled:!1,layout:"  prev, pager, next,sizes,->,jumper,total",total:a(A)},null,8,["current-page","page-size","total"])],512),[[Y,a(C)==0]]),X(e(he,{ref_key:"spuFormInstance",ref:o,onChangeScene:p},null,512),[[Y,a(C)==1]]),X(e(Ue,{ref_key:"skuFormInstance",ref:F,onChangeScene:p},null,512),[[Y,a(C)==2]]),e(c,{modelValue:N.value,"onUpdate:modelValue":i[2]||(i[2]=g=>N.value=g),title:"SKU列表"},{default:t(()=>[e(l,{border:"",data:a(r)},{default:t(()=>[e(x,{label:"SKU名字",prop:"skuName"}),e(x,{label:"SKU价格",prop:"price"}),e(x,{label:"SKU重量",prop:"weight"}),e(x,{label:"SKU图片"},{default:t(({row:g,$index:$})=>[W("img",{src:g.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Ce)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ne as default};
