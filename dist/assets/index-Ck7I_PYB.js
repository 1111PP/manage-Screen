import{M as V,d as ce,m as d,D as pe,n as me,y as ve,r as m,N as fe,o as U,c as F,g as l,w as a,B as i,q as c,O as _e,e as I,P as O,f as x,t as T,i as ge,F as j,b as we,v as M,J as g,p as ye,k as he}from"./index-DiapZNiM.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H=(s,r,f)=>V.get(`/admin/acl/user/${s}/${r}/?username=${f}`),be=s=>s.id?V.put("/admin/acl/user/update",s):V.post("/admin/acl/user/save",s),Ce=s=>V.get("/admin/acl/user/toAssign/"+s),ke=s=>V.post("/admin/acl/user/doAssignRole",s),Ue=s=>V.delete("/admin/acl/user/remove/"+s),xe=s=>V.delete("/admin/acl/user/batchRemove",{data:s}),J=s=>(ye("data-v-8e4cc4f1"),s=s(),he(),s),Le={style:{flex:"auto"}},Re=J(()=>x("h3",null," 分配用户角色 ",-1)),Se=J(()=>x("br",null,null,-1)),qe={style:{"margin-right":"100px"}},ze=ce({__name:"index",setup(s){let r=d(1),f=d(5),q=d(0),C=d([]);const w=d(!1);let u=pe({username:"",name:"",password:""});d([]);let y=d();me([r,f],()=>{b(r.value)});const b=async(t=1)=>{r.value=t;let e=await H(r.value,f.value,"");e.code==200&&(q.value=e.data.total,C.value=e.data.records)};ve(()=>{b(r.value)});const L=d(""),G=async()=>{const t=await H(r.value,f.value,L.value);t.code===200&&(q.value=t.data.total,C.value=t.data.records)},K=()=>{L.value="",b(r.value)},Q={username:[{required:!0,trigger:"blur",validator:(t,e,n)=>{e.trim().length>=5?n():n(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(t,e,n)=>{e.trim().length>=5?n():n(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(t,e,n)=>{e.trim().length>=6?n():n(new Error("用户密码至少六位"))}}]},W=()=>{w.value=!0,Object.assign(u,{username:"",name:"",password:"",id:0}),M(()=>{y.value.clearValidate("username"),y.value.clearValidate("name"),y.value.clearValidate("password")})},X=t=>{w.value=!0,Object.assign(u,t),M(()=>{y.value.clearValidate("username"),y.value.clearValidate("name")})},Y=async t=>{(await Ue(t.id)).code===200?(g({type:"success",message:"Success Del"}),b(C.value.length==1?r.value-1:r.value)):g({type:"error",message:"Failed Del"})},N=d([]),Z=async t=>{N.value=t},ee=async()=>{const t=N.value.map(e=>e.id);t.length?(await xe(t)).code===200?(g({type:"success",message:"Success Del"}),b(C.value.length==1?r.value-1:r.value)):g({type:"error",message:"Failed Del"}):g({type:"warning",message:"请选择需要删除的用户"})},le=()=>{w.value=!1},ae=async()=>{y.value.validate().then(async()=>{let t=await be(u);console.log(t),t.code==200?(w.value=!1,g({type:"success",message:u.id?"更新成功":"添加成功"}),window.location.reload()):(w.value=!1,g({type:"error",message:u.id?"更新失败":"添加失败"}))},()=>{g({type:"error",message:"表单校验失败"})})},k=d(!1),z=d(""),p=d({id:0,roleList:[]}),R=d([]),te=async t=>{p.value.roleList=[],p.value.id=0,k.value=!0;const e=await Ce(t.id);console.log(e),R.value=e.data.allRolesList,z.value=t.username,p.value.id=t.id,p.value.roleList.push(...e.data.assignRoles.map(n=>n.id)),A(p.value.roleList)},S=d(!1),oe=()=>{S.value?p.value.roleList=R.value.map(t=>t.id):p.value.roleList=[]},A=t=>{S.value=t.length===R.value.length},se=async()=>{const t=p.value.id,e=p.value.roleList;(await ke({userId:t,roleIdList:e})).code==200&&(k.value=!1,b(r.value))};return(t,e)=>{const n=m("el-input"),h=m("el-form-item"),v=m("el-button"),D=m("el-form"),P=m("el-card"),_=m("el-table-column"),re=m("el-popconfirm"),ne=m("el-table"),ue=m("el-pagination"),B=m("el-drawer"),E=m("el-checkbox"),de=m("el-checkbox-group"),ie=fe("has");return U(),F(j,null,[l(P,{style:{height:"80px"}},{default:a(()=>[l(D,{class:"form",inline:!0},{default:a(()=>[l(h,{label:"用户名"},{default:a(()=>[l(n,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=o=>L.value=o),placeholder:"请你输入搜索用户名",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(h,null,{default:a(()=>[l(v,{onClick:G,type:"primary",icon:"search"},{default:a(()=>[i("搜索")]),_:1}),l(v,{onClick:K,type:"info",icon:"Refresh"},{default:a(()=>[i("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(P,null,{default:a(()=>[l(v,{type:"primary",onClick:W,icon:"plus"},{default:a(()=>[i("添加")]),_:1}),l(v,{type:"danger",onClick:ee,icon:"delete"},{default:a(()=>[i("批量删除")]),_:1}),l(ne,{onSelectionChange:Z,border:"",style:{"margin-top":"10px"},data:c(C)},{default:a(()=>[l(_,{type:"selection"}),l(_,{type:"index",label:"#"}),l(_,{"show-overflow-tooltip":!0,prop:"id",label:"ID",width:"100"}),l(_,{"show-overflow-tooltip":!0,prop:"name",label:"用户昵称",width:"100"}),l(_,{"show-overflow-tooltip":!0,prop:"roleName",label:"用户角色",width:"100"}),l(_,{"show-overflow-tooltip":!0,prop:"createTime",label:"创建时间",width:"100"}),l(_,{"show-overflow-tooltip":!0,prop:"updateTime",label:"更新时间",width:"100"}),l(_,{label:"操作"},{default:a(({row:o,index:Ae})=>[l(v,{size:"small",icon:"user",type:"primary",onClick:$=>te(o)},{default:a(()=>[i("分配角色")]),_:2},1032,["onClick"]),l(v,{size:"small",icon:"edit",type:"warning",onClick:$=>X(o)},{default:a(()=>[i("编辑")]),_:2},1032,["onClick"]),l(re,{title:"确定删除?",width:"200px",onConfirm:$=>Y(o)},{reference:a(()=>[_e((U(),I(v,{size:"small",icon:"delete",type:"danger"},{default:a(()=>[i("删除")]),_:1})),[[ie,"btn.User.remove"]])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(ue,{style:{"margin-top":"10px"},"current-page":c(r),"onUpdate:currentPage":e[1]||(e[1]=o=>O(r)?r.value=o:r=o),"page-size":c(f),"onUpdate:pageSize":e[2]||(e[2]=o=>O(f)?f.value=o:f=o),"page-sizes":[5,10,20,30],background:!0,disabled:!1,layout:"  prev, pager, next,sizes,->,jumper,total",total:c(q)},null,8,["current-page","page-size","total"])]),_:1}),l(B,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=o=>w.value=o)},{header:a(()=>[x("h4",null,T(c(u).id?"修改用户信息":"添加用户信息"),1)]),default:a(()=>[l(D,{model:c(u),rules:Q,ref_key:"formRef",ref:y},{default:a(()=>[l(h,{label:"用户账号",prop:"username"},{default:a(()=>[l(n,{placeholder:"请您输入用户账号",modelValue:c(u).username,"onUpdate:modelValue":e[3]||(e[3]=o=>c(u).username=o)},null,8,["modelValue"])]),_:1}),l(h,{label:"用户昵称",prop:"name"},{default:a(()=>[l(n,{placeholder:"请您输入用户昵称",modelValue:c(u).name,"onUpdate:modelValue":e[4]||(e[4]=o=>c(u).name=o)},null,8,["modelValue"])]),_:1}),c(u).id?ge("",!0):(U(),I(h,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(n,{placeholder:"请您输入用户密码",modelValue:c(u).password,"onUpdate:modelValue":e[5]||(e[5]=o=>c(u).password=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:a(()=>[x("div",Le,[l(v,{type:"primary",onClick:ae},{default:a(()=>[i("确定")]),_:1}),l(v,{onClick:le},{default:a(()=>[i("取消")]),_:1})])]),_:1},8,["modelValue"]),l(B,{modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=o=>k.value=o)},{header:a(()=>[Re]),default:a(()=>[l(D,{model:p.value},{default:a(()=>[l(h,{label:"用户姓名"},{default:a(()=>[l(n,{disabled:!0,modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=o=>z.value=o)},null,8,["modelValue"])]),_:1}),l(h,{label:"角色列表"},{default:a(()=>[l(E,{onChange:oe,modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=o=>S.value=o)},{default:a(()=>[i("全选 ")]),_:1},8,["modelValue"]),l(de,{onChange:A,modelValue:p.value.roleList,"onUpdate:modelValue":e[9]||(e[9]=o=>p.value.roleList=o)},{default:a(()=>[Se,(U(!0),F(j,null,we(R.value,o=>(U(),I(E,{value:o.id,name:"type"},{default:a(()=>[i(T(o.roleName),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),footer:a(()=>[x("div",qe,[l(v,{type:"primary",onClick:se},{default:a(()=>[i("确定")]),_:1}),l(v,{onClick:e[10]||(e[10]=o=>k.value=!1)},{default:a(()=>[i("取消")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),Ee=Ve(ze,[["__scopeId","data-v-8e4cc4f1"]]);export{Ee as default};
